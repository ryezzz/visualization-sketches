{"version":3,"file":"component---src-pages-childhood-diary-swarm-scroll-js-c888080e671647f3ad57.js","mappings":"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","sources":["webpack://visualization-sketches/./src/components/ScrollySwarm/index.js","webpack://visualization-sketches/./src/pages/childhood-diary-swarm-scroll.js","webpack://visualization-sketches/./src/utils/visualizationUtils.js"],"sourcesContent":["// To fix canvas blurryness I used this: https://stackoverflow.com/questions/48961797/canvas-circle-looks-blurry\nimport { useEffect, useRef } from \"react\";\nimport { Delaunay } from \"d3-delaunay\";\nimport * as d3 from \"d3\";\nimport React from \"react\";\nimport { gsap } from \"gsap\";\nimport { isBrowser } from \"../../utils/staticRendering\";\nimport { dodge } from \"../../utils/visualizationUtils\";\n\nconst ScrollySwarm = (props) => {\n  // const [pixelRatio, setPixelRatio] = useState(2);\n\n  const pixelRatio = props.pixelRatio;\n\n  const destinationParticles = [];\n  const originParticles = [];\n  let height = props.height;\n  let width = props.width;\n  let margin = props.margin;\n  let marginLeft = props.marginLeft;\n  let marginTop = props.marginTop;\n  let particles = props.particles;\n  let ref = useRef();\n  let highlightRef = useRef();\n  let axisRef = useRef();\n  const radius = 8;\n  ////MOVE TO HOOKS\n  const usePrevious = (value, defaultRef) => {\n    const ref = useRef(defaultRef);\n    useEffect(() => {\n      ref.current = value;\n    });\n    return ref.current;\n  };\n\n  const prevDate = usePrevious(props.dateSelection, \"year\");\n\n  let rScale = d3\n    .scaleLinear()\n    .domain(d3.extent(particles, (d) => d[props.valueSelection]))\n    .range([1, height / 80]);\n\n  let x = (incomingData, prevOrCurrent) => d3\n      .scaleSequential()\n      .domain(d3.extent(particles, (d) => d[prevOrCurrent]))\n      .range([marginLeft, width - 0]);\n\n  let r = (selectedValue) => rScale(selectedValue);\n\n  const dodgedParticlesOrigin = dodge(\n    particles,\n    prevDate,\n    props.valueSelection,\n    x(particles, prevDate),\n    r,\n    0\n  );\n  const dodgedParticlesDestination = dodge(\n    particles,\n    props.dateSelection,\n    props.valueSelection,\n    x(particles, props.dateSelection),\n    r,\n    0\n  );\n\n  const tooltip =\n    isBrowser() &&\n    d3\n      .select(\"#tooltipDiv\")\n      .style(\"background-color\", \"white\")\n      .style(\"border\", \"1px solid\")\n      .style(\"border-radius\", \"2px\")\n      .style(\n        \"box-shadow\",\n        \"0 3px 6px rgba(0, 0, 0, 0.3), 0 3px 6px rgba(0, 0, 0, 0.4)\"\n      )\n      .style(\"opacity\", 0)\n      .style(\"padding\", \"10px\");\n\n  function showTooltip(tooltipX, tooltipY, tooltipZ, xScalei, yScalei) {\n    isBrowser() &&\n      tooltip\n        .style(\"opacity\", 0.7)\n        .style(\"display\", \"block\")\n        .style(\"top\", yScalei + \"px\")\n        .style(\"left\", xScalei + 15 + \"px\")\n        .style(\"z-index\", 5)\n        .html(\n          `<div>word_count: <b>${tooltipY}</b></div><div>${props.dateSelection}: <b>${tooltipX}</b></div>  <div></div>`\n        );\n  }\n\n  const delaunay2 = (dateString, x, y) =>\n    Delaunay.from(dodgedParticlesDestination.map((d) => [d.x, d.y]));\n\n  const xAxisScale = d3\n    .scaleSequential()\n    .domain(d3.extent(particles, (d) => d[props.dateSelection]))\n    .range([marginLeft, width - margin]);\n\n  const xAxis = d3\n    .axisBottom(xAxisScale)\n    .ticks(5)\n    .tickFormat((d) => `${d}`);\n\n  useEffect(() => {\n    //************************************************************\n    // ***** Scale Canvas and prep\n    // ***********************************************************\n    const canvas = ref.current;\n    const context = canvas.getContext(\"2d\");\n    context.scale(pixelRatio, pixelRatio);\n    context.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n    context.globalAlpha = 0.4;\n    //************************************************************\n    // ***** End Scale Canvas and prep\n    // ***********************************************************\n\n    const update = () => {\n      context.fillStyle = \"rgb(226, 99, 255)\";\n      context.strokeStyle = \"rgb(226, 99, 255)\";\n\n      const animation = () =>\n        gsap.fromTo(\n          dodgedParticlesOrigin,\n          {\n            x: (index) => dodgedParticlesOrigin[index].x,\n            y: (index) => dodgedParticlesOrigin[index].y,\n          },\n          {\n            x: (index) => dodgedParticlesDestination[index].x,\n            y: (index) => dodgedParticlesDestination[index].y,\n            // ease: \"power.3.out\",\n            duration: 0.5,\n\n            // Documentation: https://greensock.com/docs/v3/Staggers\n            ease: \"strong.inOut\",\n            // runBackwards: true,\n            onUpdate: animate,\n\n            stagger: {\n              each: 0.0005,\n              from: \"random\",\n            },\n          }\n        );\n\n      animation();\n\n      function animate() {\n        context.restore();\n\n        context.clearRect(0, 0, width, height);\n\n        d3.select(axisRef.current).call(xAxis).transition();\n        context.beginPath();\n        dodgedParticlesOrigin.map(\n          (d, i) => (\n            context.beginPath(),\n            context.arc(d.x, height - d.y, d.r, 0, 2 * Math.PI),\n            // context.stroke()\n            context.fill()\n          )\n        );\n      }\n    };\n\n    onscroll = (event) => {\n      pointHoverOut();\n    };\n\n    const pointHoverIn = (hoverActive) => {\n\n      console.log(\"hoveractive\", hoverActive)\n\n\n      let xSelection = hoverActive.x;\n\n      let ySelection = hoverActive.y;\n      const pageYoffset = isBrowser() ? window.pageYOffset : 0;\n\n      d3.select(highlightRef.current)\n        .attr(\"r\", hoverActive.r)\n        .attr(\"cx\", xSelection)\n        .attr(\"cy\", height - ySelection )\n        .attr(\"fill\", \"rgba(255,255,255,.7)\");\n      // .attr(\"stroke\", \"rgba(255,255,255, 1)\");\n    };\n\n    const pointHoverOut = () => {\n      d3.select(highlightRef.current).attr(\"r\", 0);\n    };\n\n    function hideTooltip(hoverInactive) {\n      isBrowser && tooltip.style(\"display\", \"none\");\n      isBrowser && tooltip.style(\"opacity\", \"0\");\n    }\n    onmousemove = (event) => {\n      event.preventDefault();\n      const pageYoffset = isBrowser() ? window.pageYOffset : 0;\n      let mousePoint = d3.pointer(event, this);\n      let xi = mousePoint[0];\n      let y = height - mousePoint[1] - [pageYoffset];\n      let heightCond = xi < width;\n      let index = delaunay2(props.dateSelection).find(xi, y);\n      console.log(index)\n      let indexObj = dodgedParticlesDestination[index];\n      console.log(indexObj)\n      let tooltipX = indexObj.x;\n      let tooltipY = height - indexObj.y;\n      let tooltipZ = indexObj.r;\n\n      heightCond\n        ? showTooltip(\n            tooltipX,\n            tooltipY,\n            tooltipZ,\n            tooltipX,\n            tooltipY\n          )\n        : hideTooltip(indexObj);\n\n      heightCond ? pointHoverIn(indexObj) : pointHoverOut(indexObj);\n    };\n\n    update();\n  }, [props.dateSelection, props.width, props.height, props.pixelRatio]);\n\n  if (isBrowser() === false) {\n    return <></>;\n  }\n  return (\n    <div className=\"canvasStickyChartContainer\">\n      <div id=\"tooltipDiv\" className=\"tooltipDiv\" />\n\n      <svg className=\"canvasStickyPointHighlight\" width={width} height={height}>\n        <circle r={0} className=\"highlightCircle\" ref={highlightRef}></circle>\n      </svg>\n      <canvas\n        className={\"canvasStickyChart\"}\n        style={{\n          width: props.width + \"px\",\n          height: props.height + \"px\",\n        }}\n        ref={ref}\n        particles={props.particles}\n        stroke={props.stroke}\n        width={props.width * props.pixelRatio}\n        height={props.height * props.pixelRatio}\n        useScrollData={props.useScrollData}\n        dateSelection={props.dateSelection}\n        valueSelection={props.valueSelection}\n        margin={props.margin}\n      />\n      <svg style={{ top: props.height - 1 }} className=\"canvasStickyChartAxis\">\n        <g className=\"darkModeAxis\" ref={axisRef}></g>\n      </svg>\n    </div>\n  );\n};\n\nexport default ScrollySwarm;\n","import React, { useState } from \"react\";\nimport ScrollySwarm from \"../components/ScrollySwarm\";\nimport { useScrollData } from \"scroll-data-hook\";\nimport debounce from \"debounce\";\nimport { Scrollama, Step } from \"react-scrollama\";\nimport { graphql } from \"gatsby\";\nimport \"../styles.css\";\nimport { isBrowser } from \"../utils/staticRendering\";\nimport { scatterScrollingtext } from \"../utils/childhoodDiaryUtils\";\nimport { formatDataFunct } from \"../utils/childhoodDiaryUtils\";\n// import * as Scroll from 'react-scroll';\n\nconst ScrollySwarmPage = ({ data }) => {\n  const diaryRawData = data.allDataCsv.edges[0].node.items;\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [pixelRatio, setPixelRatio] = useState(\n    isBrowser() ? window.devicePixelRatio : 0\n  );\n  const [currentWidth, setCurrentWidth] = useState(\n    isBrowser() ? window.innerWidth : 0\n  );\n  const [currentHeight, setCurrentHeight] = useState(\n    isBrowser() ? window.innerHeight : 0\n  );\n  const onStepEnter = (stepdata) => {\n    setCurrentStepIndex(stepdata.data);\n  };\n\n  React.useEffect(() => {\n    if (isBrowser()) {\n      setCurrentWidth(window.innerWidth);\n      setCurrentHeight(window.innerHeight);\n      setPixelRatio(window.devicePixelRatio);\n      window.onresize = function (event) {\n        setCurrentWidth(window.innerWidth);\n        setCurrentHeight(window.innerHeight);\n        setPixelRatio(window.devicePixelRatio);\n      };\n    }\n  }, [currentWidth, pixelRatio]);\n\n  if (isBrowser() === false) {\n    return <></>;\n  }\n\n  return (\n    <div>\n      <div>\n        <ScrollySwarm\n          className={\"staticGraphicContainer\"}\n          height={currentHeight * 0.95}\n          width={currentWidth * 0.6}\n          particles={formatDataFunct(diaryRawData)}\n          useScrollData={useScrollData}\n          dateSelection={scatterScrollingtext(currentStepIndex).date_selection}\n          valueSelection=\"entry_word_count\"\n          stepIndex={currentStepIndex}\n          margin={10}\n          marginLeft={currentWidth * 0.1}\n          marginTop={currentHeight * 0.7}\n          pixelRatio={pixelRatio}\n        />\n\n        <div className=\"scrollingTextContainer darkModeScrollingTitle\">\n          <Scrollama\n            offset={.5}\n            onStepEnter={onStepEnter}\n            debug={false}\n          >\n            {[0, 1, 2, 3].map((_, stepIndex) => (\n              <Step data={stepIndex} key={stepIndex}>\n                <div\n                  style={{ opacity: currentStepIndex === stepIndex ? 1 : 0.2 }}\n                  class=\"textStep\"\n                >\n                  {scatterScrollingtext(stepIndex).title}\n                </div>\n              </Step>\n            ))}\n          </Scrollama>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const query = graphql`\n  query ScrollySwarmPage {\n    allDataCsv {\n      edges {\n        node {\n          items {\n            date\n            formatted_date\n            entry_word_count\n            quarter\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport default ScrollySwarmPage\n","export const dodge = (data, selectedDateI, selectedValueI, xScaleI, rScaleI, paddingI) => {\n  const circles = data\n    .map((d) => ({ x: xScaleI(d[selectedDateI]), r: rScaleI(d[selectedValueI]), data: d }))\n    // .sort((a, b) => b.r - a.r);\n\n  const epsilon = 1e-3;\n  let head = null,\n    tail = null,\n    queue = null;\n\n  //   // Returns true if circle ⟨x,y⟩ intersects with any circle in the queue.\n  function intersects(x, y, r) {\n    let a = head;\n    while (a) {\n      const radius2 = (a.r + r + paddingI) ** 2;\n      if (radius2 - epsilon > (a.x - x) ** 2 + (a.y - y) ** 2) {\n        return true;\n      }\n      a = a.next;\n    }\n    return false;\n  }\n\n  //   // Place each circle sequentially.\n  for (const b of circles) {\n    //     // Choose the minimum non-intersecting tangent.\n    if (intersects(b.x, (b.y = b.r), b.r)) {\n      let a = head;\n      b.y = Infinity;\n      do {\n        let y =\n          a.y + Math.sqrt((a.r + b.r + paddingI) ** 2 - (a.x - b.x) ** 2);\n        if (y < b.y && !intersects(b.x, y, b.r)) b.y = y;\n        a = a.next;\n      } while (a);\n    }\n\n    //     // Add b to the queue.\n    b.next = null;\n    if (head === null) {\n      head = tail = b;\n      queue = head;\n    } else tail = tail.next = b;\n  }\n\n  return circles;\n};\n"],"names":["props","pixelRatio","height","width","margin","marginLeft","particles","marginTop","ref","useRef","highlightRef","axisRef","prevDate","value","defaultRef","useEffect","current","usePrevious","dateSelection","rScale","d3","domain","d","valueSelection","range","x","incomingData","prevOrCurrent","r","selectedValue","dodgedParticlesOrigin","dodge","dodgedParticlesDestination","tooltip","isBrowser","style","xAxisScale","xAxis","ticks","tickFormat","context","getContext","scale","setTransform","globalAlpha","onscroll","event","pointHoverOut","attr","onmousemove","preventDefault","pageYoffset","window","pageYOffset","mousePoint","xi","y","heightCond","index","Delaunay","map","find","console","log","indexObj","tooltipX","tooltipY","tooltipZ","xScalei","yScalei","html","showTooltip","hoverActive","xSelection","ySelection","pointHoverIn","fillStyle","strokeStyle","animate","restore","clearRect","call","transition","beginPath","i","arc","Math","PI","fill","gsap","duration","ease","onUpdate","stagger","each","from","update","className","id","stroke","useScrollData","top","diaryRawData","data","allDataCsv","edges","node","items","useState","currentStepIndex","setCurrentStepIndex","devicePixelRatio","setPixelRatio","innerWidth","currentWidth","setCurrentWidth","innerHeight","currentHeight","setCurrentHeight","React","onresize","formatDataFunct","scatterScrollingtext","date_selection","stepIndex","offset","onStepEnter","stepdata","debug","_","key","opacity","class","title","selectedDateI","selectedValueI","xScaleI","rScaleI","paddingI","circles","head","tail","intersects","a","next","b","Infinity","sqrt"],"sourceRoot":""}