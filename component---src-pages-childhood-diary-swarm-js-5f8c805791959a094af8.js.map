{"version":3,"file":"component---src-pages-childhood-diary-swarm-js-5f8c805791959a094af8.js","mappings":"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","sources":["webpack://visualization-sketches/./src/consts/childhoodDiaryConsts.js","webpack://visualization-sketches/./src/components/BeeswarmSvg/index.js","webpack://visualization-sketches/./src/pages/childhood-diary-swarm.js"],"sourcesContent":["export const unNestDiaryData =(elem)=>elem.allDataCsv.edges[0].node.items\n// .allDataCsv.edges[0].node.items\n","import { useEffect, useRef, useState } from \"react\";\nimport { Delaunay } from \"d3-delaunay\";\nimport * as d3 from \"d3\";\nimport React from \"react\";\nimport { gsap } from \"gsap\";\nimport { isBrowser } from \"../../utils/staticRendering\";\nimport { select } from \"d3\";\n\nfunction thresholdTime(n) {\n  return (data, min, max) => {\n    return d3.scaleSequential().domain([min, max]).ticks(n);\n  };\n}\n\nconst BeeswarmSvg = (props) => {\n  const [circleData, setCircleData] = useState(null);\n\n  const data = props.data;\n  const selectedDate = props.selectedDate;\n  const selectedValue = props.selectedValue;\n  const height = props.height;\n  const width = props.width;\n  const margin = props.margin;\n  const marginLeft = props.margin;\n  const marginTop = props.marginTop;\n  const marginBottom = props.marginTop;\n  const marginRight = props.marginRight;\n  const padding = 0;\n\n  const binnedData = d3\n    .bin()\n    .value((d) => d[selectedDate])\n    .thresholds(thresholdTime(20));\n\n  let xScale = d3\n    .scaleLinear()\n    .domain(d3.extent(binnedData(data), (d, i) => (d.x1 * i) / 15))\n    .range([marginLeft, width - margin]);\n\n  let rScale = d3\n    .scaleLinear()\n    .domain(d3.extent(data, (d) => d[selectedValue]))\n    .range([1, height/80]);\n\n    // let rScaleMain = d3\n    // .scaleLinear()\n    // // .domain(d3.extent(binnedData(formattedData), (d, i) => console.log(\"testingxscale\", d),  d.week))\n    // // .domain(d3.extent(binnedData(formattedData), (d, i) => d.map((di,ii)=>di.entry_word_count)))\n    // .domain(d3.extent(data, (d)=> d[selectedValue]))\n    // .range([1, 10])\n\n  let yScale = d3.stack().keys(d3.extent(data, (d) => d[selectedValue]));\n\n  // useEffect(() => {\n  let x = d3\n    .scaleSequential()\n    .domain(d3.extent(data, (d) => d[selectedDate]))\n    .range([marginLeft, width - marginRight]);\n\n  let r = (selectedValue) => rScale(selectedValue);\n\n\n\n\n  let dodge = (data) => {\n    const circles = data\n      .map((d) => ({ x: x(d[selectedDate]), r: r(d[selectedValue]), data: d }))\n      // .sort((a, b) => b.r - a.r);\n\n    const epsilon = 1e-3;\n    let head = null,\n      tail = null,\n      queue = null;\n\n    //   // Returns true if circle ⟨x,y⟩ intersects with any circle in the queue.\n    function intersects(x, y, r) {\n      let a = head;\n      while (a) {\n        const radius2 = (a.r + r + padding) ** 2;\n        if (radius2 - epsilon > (a.x - x) ** 2 + (a.y - y) ** 2) {\n          return true;\n        }\n        a = a.next;\n      }\n      return false;\n    }\n\n    //   // Place each circle sequentially.\n    for (const b of circles) {\n      //     // Choose the minimum non-intersecting tangent.\n      if (intersects(b.x, (b.y = b.r), b.r)) {\n        let a = head;\n        b.y = Infinity;\n        do {\n          let y =\n            a.y + Math.sqrt((a.r + b.r + padding) ** 2 - (a.x - b.x) ** 2);\n          if (y < b.y && !intersects(b.x, y, b.r)) b.y = y;\n          a = a.next;\n        } while (a);\n      }\n\n      //     // Add b to the queue.\n      b.next = null;\n      if (head === null) {\n        head = tail = b;\n        queue = head;\n      } else tail = tail.next = b;\n    }\n\n    return circles;\n  };\n\n  console.log(\"DODGE\", dodge(data));\n\n  // console.log(\"CIRCLE DATA\", circleData)\n\n  // }, [circleData]);\n  return (\n    <div>\n      <svg style={{ border: \"solid 2px white\", width: width, height: height }}>\n      <g width={width} height={height} transform={`translate(${10},${10})`}>\n\n        {dodge(data).map((d, i) => (\n\n            <circle\n            cx={d.x}\n            cy={height - marginBottom - padding - d.y}\n            r={d.r}\n            fill=\"white\"\n\n            >\n\n              {console.log(\"Finding radius\", d.r)}\n                   {/*  <g transform={`translate( ${xScale(d.x1)}  ${height})`}>\n          {d.map((di, ii) => (\n              <circle\n                r={rScale(di[selectedValue])}\n                fill=\"white\"\n                cx={(di[selectedDate], xScale(di[selectedDate]))}\n                cy={ii * -7}\n              ></circle>\n            ))}\n          </g>*/}\n\n            </circle>\n\n        )\n        )}\n\n        </g> </svg>{\" \"}\n    </div>\n  );\n};\n\nexport default BeeswarmSvg;\n","// FIGURING OUT YSCALE FOR STACKED ELEMENTS\n\nimport React, { useEffect, useState, useRef } from \"react\";\nimport { graphql } from \"gatsby\";\nimport \"../styles.css\";\nimport { unNestDiaryData } from \"../consts/childhoodDiaryConsts\";\nimport { formatDataFunct } from \"../utils/childhoodDiaryUtils\";\nimport BeeswarmSvg from \"../components/BeeswarmSvg\";\n\nconst ChildhoodDiaryBinned = ({ data }) => {\n  const [width, setWidth] = useState(10000);\n  const [height, setHeight] = useState(10000);\n  const margin = 0;\n  const marginLeft = 100;\n  const marginRight= 100;\n\n  const marginTop = 0;\n  const containerRef = useRef();\n  const unNestData = unNestDiaryData(data);\n  const formattedData = formatDataFunct(unNestData);\n\n  useEffect(() => {\n    setWidth(containerRef.current.clientWidth);\n    setHeight(containerRef.current.clientHeight);\n    window.onresize = function () {\n      setWidth(containerRef.current.clientWidth);\n      setHeight(containerRef.current.clientHeight);\n\n    };\n  }, [width, height]);\n\n  return (\n    <div\n      ref={containerRef}\n      style={{ border: \"solid 2px white\", width: \"100%\", height: \"100vh\" }}\n    >\n      <BeeswarmSvg\n        selectedDate=\"week\"\n        selectedValue=\"entry_word_count\"\n        data={formattedData}\n        margin={margin}\n        marginLeft={marginLeft}\n        marginTop={marginTop}\n        marginRight={marginRight}\n        width={width}\n        height={height}\n      />\n    </div>\n  );\n};\n\nexport const query = graphql`\n  query ChildhoodDiaryBinnedQuery {\n    allDataCsv {\n      edges {\n        node {\n          items {\n            date\n            formatted_date\n            entry_word_count\n            quarter\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport default ChildhoodDiaryBinned;\n"],"names":["unNestDiaryData","elem","allDataCsv","edges","node","items","props","n","useState","data","selectedDate","selectedValue","height","width","margin","marginLeft","marginBottom","marginTop","marginRight","binnedData","d3","value","d","thresholds","min","max","domain","ticks","rScale","i","x1","range","x","keys","r","dodge","circles","map","head","tail","intersects","y","a","next","b","Infinity","Math","sqrt","console","log","style","border","transform","cx","cy","fill","setWidth","setHeight","containerRef","useRef","unNestData","formattedData","formatDataFunct","useEffect","current","clientWidth","clientHeight","window","onresize","ref"],"sourceRoot":""}